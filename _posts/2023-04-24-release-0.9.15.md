---
layout: post
comments: true
title:  "CARLA 0.9.15 Release"
subtitle: "Town 13, Digital Twins, "
description: "New large map, multi-GPU, Native ROS support, "
author: "@MattRoweEAIF"
image: 'img/carla.jpg'
background: '/img/posts/2022-12-16/town12_banner.png'
---

{% include youtube.html id="AZhzZy57XeU" %}

{% include release_button.html release_tag="0.9.15" %}

We are pleased to present to you the latest version of CARLA, version 0.9.15! This version brings a huge new town, native support for ROS a procedural map generation tools to take your CARLA workflow to the next level.

0.9.15 introduces Town 13, a new Large Map of 10x10 km<sup>2</sup>. Town 13 is an ideal companion to Town 12, completing a powerful train-test pair to expose overfitting issues!

This release introduces some incredible new procedural map generation tools to accelerate your environment generation. The Digital Twin Tool enables a 3D map to be generated from a digital representation of real-world road networks, fully populated with buildings and vegetation. The procedural building tool also allows the creation of buildings using a selection of facia building blocks and 

The CARLA vehicle catalogue now includes a new truck [__Mitsubishi Fuso Rosa bus__](#mitsubishi-fuso-rosa-bus). 

This version of CARLA includes [__new semantic classes__](#new-semantic-segmentation-classes) to further differentiate vehicle types. Buses, trucks, bicycles, motorcycles and riders now have their own semantic IDs and colors matching the [__Cityscapes__](https://www.cityscapes-dataset.com/dataset-overview/#features) color pallette.

[__N-wheeled vehicles__](#n-wheeled-vehicles) are now supported by CARLA's engine, enabling users to import models of heavy goods and industrial vehicles with 3 or more axles. 

And last but not least, version 0.9.14 comes with numerous [__fixes and improvements__](#improvements-and-fixes). CARLA now has an Ackermann control built into the API, vehicle objects now have additional attributes to help filter and organise them and the Traffic Manager has new functions to offset the vehicle from the lane center. 

We hope you enjoy reading about CARLA's latest features!


## Town 13

Town 13 has shares many similarities with Town 12, an extensive road network, high rise, residential and rural areas, vegetation and water features. However, Town 13's road network has some very different features compared to that of Town 12 and the architectural styles of each area of the city are quite distinct. To add to this Town 13 is decorated with new styles of vegetation. This makes Town 13 an ideal companion to Town 12 as a train-test pair. Deriving your training data using one of the pair of towns and then running your validation in the other is a powerful method for exposing overfitting issues in your AD stack.

__High-rise central business district__:

Town 12's central business district is a large area of high rise skyscrapers arranged into blocks on a consistent grid of roads, resembling downtown areas in many large American and European cities.

![high_rise](/img/posts/2022-12-16/high_rise.webp){:class="img-fluid rounded mx-auto d-block"}

__High density residential__:

The high density residential areas of Town 12 have many 2-10 storey apartment buildings with commercial properties like cafes and retail stores at street level.

![high_dens_res](/img/posts/2022-12-16/high_dens_res.webp){:class="img-fluid rounded mx-auto d-block"}

__Low density residential__:

The low density residential regions of Town 12 reflect the classic suburbs of many American cities, with one and two story homes surrounded by fenced gardens and garages.

![low_dens_res](/img/posts/2022-12-16/low_dens_res.webp){:class="img-fluid rounded mx-auto d-block"}

__Highways and intersections__:

Town 12 has an extensive highway system, including 3-4 lane highways interspersed with impressive roundabout junctions.

![highway](/img/posts/2022-12-16/highway.webp){:class="img-fluid rounded mx-auto d-block"}

__Rural and farmland__:

Town 12 also has rural regions with characteristic farmland buildings like wooden barns and farmhouses, windmills, grain silos, corn fields, hay bails and rural fencing. 

![rural](/img/posts/2022-12-16/rural.webp){:class="img-fluid rounded mx-auto d-block"}

## Procedural Map Generation Tools

CARLA 0.9.15 introduces two new experimental features for the procedural generation of new maps. 

### Digital Twin Tool

The digital twin tool generates unique CARLA maps based on areas of road network derived from OpenStreetMap data. Users can download an area of OSM data as input for the tool and browse the map using the interface. When an area of interest is chosen, the tool will extract the roads then decorate them with realistic road surfaces, generating 3D buildings to fill the spaces between the roads. The result is a unique CARLA map with a road network representing a digital twin of a real-world road network. The buildings are generated matching the footprint and height data extracted from OSM, so the buildings in the digital twin proportionally match the real buildings in the chosen map region. Buildings are clad in a variety of styles drawn from the CARLA asset library to create visual diversity. 

## Heavy Goods Vehicle

CARLA's array of vehicles for simulation has grown with the addition of a Cab-Over-Engine style heavy goods vehicle, of the style commonly used throughout Europe for transportation. 

![new_semantic_classes](/img/posts/2022-12-16/new_semantic_classes.gif){:class="img-fluid rounded mx-auto d-block"}

## Mitsubishi Fuso Rosa bus

The CARLA garage presents a brand new public transit vehicle. The Mitsubishi Fuso Rosa is a widely used 20-25 seat bus, used by both private travel companies and public transport authorities around the world with tens of thousands produced every year. 

![fuso_rosa_bus](/img/posts/2022-12-16/fuso_rosa.png){:class="img-fluid rounded mx-auto d-block"}

## N-wheeled Vehicles

CARLA now supports vehicles with more than four wheels. Users can now develop models of heavy goods and industrial vehicles with 3 or more axles and import them into CARLA.

![n_wheeled](/img/posts/2022-12-16/6_wheel_truck.png){:class="img-fluid rounded mx-auto d-block"}

## New Camera Post Processing Effects

CARLA camera sensors can now simulate the distorting effects of rain and dust contamination of the lens, adding an extra level of realism to your training data and presenting challenges for testing your AD stacks with imperfect data. 

## Improvements and fixes

As with every CARLA release, we continue our efforts to improve the workflow and fix bugs. The following are some key improvements and fixes:

__New vehicle attributes__:

Vehicle blueprints now have new attributes to help organize and filter them better:

- `base_type`: can be use as a vehicle classification. The possible values are  *car*, *truck*, *van*, *motorcycle* and *bicycle*.
- `special_type`: provides more information about the vehicle. It is currently restricted to *electric*, *emergency* and *taxi*, and not all vehicles have this attribute filled.
- `has_dynamic_doors`: can either be *true* or *false* depending on whether or not the vehicle has doors that can be opened using the API.
- `has_lights`: works in the same way as *has_dynamic_doors*, but differentiates between vehicles with lights, and those that don't. 

__Native Ackermann controller__:

The CARLA API now has methods for applying Ackermann controls to a vehicle:

- `apply_ackermann_control`:  to apply an Ackermann control command to a vehicle
- `get_ackermann_controller_settings`: to get the last Ackermann controller settings applied
- `apply_ackermann_controller_settings`: to apply new Ackermann controller settings

__New Traffic Manager methods__:

The Traffic Manager has new methods to offset the vehicle from the lane center:

- `vehicle_lane_offset(actor, offset)`
- `global_lane_offset(offset)`

__Other fixes and improvements__:

* Fixed bug in FrictionTrigger causing sometimes server segfault
* Added attachment type "SpringArmGhost" for cinematic cameras but without doing the collision test.
* Improved algorithm to move signals out of the road by computing the desired displacement direction.
* Some of the warnings shown when building a map will now only be showing when debugging.
* The ids for semantic segmentation has been modified to be the same as cityscapes (labels, ids and colors)
* Fixed bug causing traffic signals at the end points of a road to sometimes create malformed waypoints.
* Fixed pedestrian skeleton frame, where sometimes it was draw displaced from the body
* Fixed decals when importing maps. It was using other .json files found in other packages.
* In multi-GPU mode some sensors now are forced to be created on the primary server always (ex. collision sensor)
* Added the speed limits for 100, 110 and 120 Km/h.
* Fixing sensor destruction, now the stream and socket is succesfully destroyed.
* Fixed bug at `Vehicle.get_traffic_light_state()` and `Vehicle.is_at_traffic_light()` causing vehicles to temporarily not lose the information of a traffic light if they moved away from it before it turned green.
* Changed the height of the automatic spawn points, from 3m to only 0.5m
* Added pedestrian skeleton to the recorder, as additional data. They will replay with the exact pose.
* Added multi-GPU feature. Now several servers (with dedicated GPU) can render sensors for the same simulation.
* Fixed bug causing the `Vehicle.get_traffic_light_state()` function not notify about the green to yellow and yellow to red light state changes.
* Fixed bug causing the `Vehicle.is_at_traffic_light()` function to return *false* if the traffic light was green.
* Fixed bug causing the scene lights to return an incorrect location at large maps.
* Fixed bug causing the `world.ground_projection()` function to return an incorrect location at large maps.
* Added failure state to vehicles, which can be retrieved by using `Vehicle.get_failure_state()`. Only Rollover failure state is currently supported.
* Fixed bug causing the TM to block the simulation when a vehicle with no physics was teleported.
* Fixed bug causing the TM to block the simulation when travelling through a short roads that looped on themselves.
* Improved the TM's handling of non signalized junctions, resulting in a more fluid overall behavior.
* Added check to avoid adding procedural trigger boxes inside intersections.
* Python agents now accept a carla.Map and GlobalRoutePlanner instances as inputs, avoiding the need to recompute them.
* Python agents now have a function to lane change.
* Python agents now detect vehicle in adjacent lanes if invaded due to the offset.
* Fixed bug causing the python agents to sometimes not detect a blocking actor if there were severral actors around it.
* Improved Python agents performance for large maps.
* Fix a bug at `Map.get_topology()`, causing lanes with no successors to not be part of it.
* Added new ConstantVelocityAgent
* Added new parameter to the TrafficManager, `set_desired_speed`, to set a vehicle's speed.
* Fixed bug causing the Traffic Manager to not be deterministic when using hybrid mode
* Added `NormalsSensor`, a new sensor with normals information
* Added support for N wheeled vehicles
* Added support for new batch commands ConsoleCommand, ApplyLocation (to actor), SetTrafficLightState
* Added new API function: `set_day_night_cycle` at the LightManager, to (de)activate the automatic switch of the lights when the simulation changes from day to night mode, and viceversa.
* Switch to boost::variant2 for rpc::Command as that allows more than 20 RPC commands
* Added post process effects for rainy and dusty weathers.
* Switched data type of the dust storm weather parameter from bool to float.
* Check for the version of the installed Clang compiler during build.
* Added API function to get direct access to the GBuffer textures of a sensor:
  - `listen_to_gbuffer`: to set a callback for a specific GBuffer texture


