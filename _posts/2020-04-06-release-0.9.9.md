---
layout: post
comments: true
title:  "CARLA 0.9.9 release"
subtitle: "CARLA..."
description: "CARLA..."
author: "@sergi-e"
date:   2020-04-04 10:00:00 +0002
image: 'img/carla.jpg'
background: '/img/posts/2019-12-11/Bann001.jpg'
---

It's not been long, but the CARLA team is thrilled to release __CARLA 0.9.9__! Buckle up, because it comes ready to drift!  

The development has been brief but intense, and there are plenty of announces to make. There are some major upgrades, such as CARLA running on the lastest version of Unreal Engine, and a new method to ingest assets out-of-the-box using Docker. Previous features and modules are growing strong. SUMO co-simulation, OpenDRIVE standalone mode and Traffic Manager have been improved greatly. But there are also new integrations in CARLA, including the RSS sensor or the PTV-Vissim co-simulation. Even traffic signs and lights has been upgraded to be managed directly from OpenDRIVE. The documentation keeps up to date with all of these improvements, and features new tutorials. Last but not least, there is a new map in CARLA. __It is opening day in Town10HD!__ 

Here is a summary and link for every feature included in CARLA 0.9.9

*   __[UE4.24 upgrade.](#ue-4.24-upgrade)__ CARLA runs now with the latest version of Unreal Engine.  
*   __[Docker ingestion.](#docker-ingestion)__ A new way to ingest assets into CARLA that automatizes the process. 
*   __[PTV-Vissim co-simulation.](#PTV-Vissim-co-simulation)__ The CARLA ecosystem expands to integrate PTV-Vissim.  
*   __[SUMO co-simulation.](#sumo-co-simulation)__ This new iteration introduces co-simulation of traffic lights, and  in Town04 and Town05. 
*   __[OpenDRIVE standalone mode.](#opendrive-standalone-mode)__ Crosswalks are now enabled for pedestrian navigation, and there are safety checks to avoid the vehicles from falling off into the abyss.  
*   __[RSS sensor.](#rss-sensor)__ The integration of the RSS library is now operative in the whole road network, including junctions. 
*   __[Traffic Manager.](#traffic-manager)__ The module has now a hybrid mode available to disable irrelevant physics far from an ego vehicle. Besides that, there are major architecture changes, and performance improvements. 
*   __[OpenDRIVE landmarks.](#opendrive-landmarks)__ One of the game changers. CARLA now manages landmarks defined in the OpenDRIVE file. That allows for a wide set of signs, and automatic generation for traffic lights, stops and yields.  
*   __[API extension.](#api-extension)__ The API has been upgraded to include everything needed to manage landmarks and the RSS sensor.  
*   __[Documentation.](#documentation)__ Now features new tutorials for retrieving data, and importing new assets into CARLA.  
*   __[Town10HD.](#town10hd)__ A completely new CARLA map designed to be the spearhead in CARLA's orientation towards realism.  

Let's take a look!

{% include youtube.html id="08Ea8Bm2Dow" %}

{% include release_button.html release_tag="0.9.8" %}

<br>

## UE4.24 upgrade
---

In order to work with the current version of CARLA, there two things to be done. 

1. Delete the UE4.22 version of the system and download a UE4.24.x. 

2. Upgrade to clang-8 with the following commands. 

```sh
sudo apt install clang-8 lld-8
sudo update-alternatives --install /usr/bin/clang++ clang++ /usr/lib/llvm-8/bin/clang++ 180
sudo update-alternatives --install /usr/bin/clang clang /usr/lib/llvm-8/bin/clang 180
rm -fr Build
make clean
make launch
```

## Docker ingestion
---

## PTV-Vissim co-simulation
---
CARLA and PTV-Vissim can run a synchronous simulation. Vehicles spawned in one simulator will do so in the other, and traffic conditions will be updated in parallel. In order work, the system must count with [__PTV-Vissim__](https://www.ptvgroup.com/en/solutions/products/ptv-vissim/), and the __Driving simulator interface__ package.  

Everything related with the PTV-Vissim integration can be found in `Co-Simulation/PTV-Vissim`. There is a script in there to run the co-simulation, and examples for __Town01__ and __Town03__. Here is an example of how to run the co-simulation using the __Town03__ example. 
```sh
python3 run_synchronization.py -c examples/Town03/Town03.inpx
```

So far, this feature is still experimental, and there are some things to take into account.  

* Due to PTV-Vissim limitations, the amount of vehicles that will be spawned from CARLA has to be stated beforehand.  
> How to set this. 
* The synchronization of the vehicle's characteristics is close, but not perfect.  
* Traffic lights have not been implemented yet.  


## SUMO co-simulation
---
In order to ease the usage of this feature, there are two more examples for __Town-4__ and __Town05__ available in CARLA. These can be found in `Co-Simulation/Sumo/examples` and run with the previous synchronization script.  

However, the co-simulation can run with any OpenDRIVE file. Speaking of which, traffic lights are now also integrated in the co-simulation! As long as they are defined in the OpenDRIVE road map, they will feature in SUMO. The user also has the ability to choose which simulator is in charge of changing the traffic lights's state. The other will update state according to it in parallel. 
> How to choose who's in charge. 

## OpenDRIVE standalone mode
---

## RSS sensor
---

## Traffic Manager
---


## Landmark management
---

## API extension
---

## Documentation
---
The documentation has been updated to meet with the upgrades mentioned in previous sections. That includes a new [__RSS sensor__](https://carla.readthedocs.io/en/latest/adv_rss/) page, and changes in the [__Python API__](https://carla.readthedocs.io/en/latest/python_api/), and [__sensors__](https://carla.readthedocs.io/en/latest/ref_sensors/) references.

Besides that, the __Tutorial (Assets)__ section is being revisited.  
* __Import new assets.__ This 
* __Map creation.__ 
* __Standalone assets packages.__


## Town10HD
---

```
BP_Procedural_Buildings
Una herramienta muy versatil, que nos permite crear edificios modulares hechos por piezas. El BP te permite configurar el alto ancho y largo del edificios. Al igual que poder poner varias versiones de la misma pieza que luego se spawnean de manera random, para dar más realismo y variedad. Además, todas las piezas son instanciades para una mejor rendimiento. 
```

## Segment 02
---

The new deb package system consists of an online repository containing a collection of files to easily distribute CARLA. This is available in Ubuntu using  APT command. This feature makes the installation of CARLA a straightforward process.  

The following commands show how to use APT to install CARLA in a Ubuntu system. Right now the repository contains CARLA 0.9.7, but 0.9.8 will be available in a few days.  

![ros_ad_demo](/img/posts/2020-03-03/ros_ad_demo02.gif){:class="img-fluid"}

<div class="alert alert-warning">
  <small><i><strong>Warning!</strong> This feature has only been tested thoroughly in Town01.</i></small>
</div>

<iframe frameborder="0" class="juxtapose" width="100%" height="394" src="https://cdn.knightlab.com/libs/juxtapose/latest/embed/index.html?uid=e7b331a0-5ca4-11ea-b9b8-0edaf8f81e27"></iframe>


## Changelog
---

- __Upgrade to UE4.24.__  
  + Currently using UE4.24.x.  
  + Upgrade to clang-8.  

- __Docker ingestion.__  
  + New method to import assets using a UE Docker image.  

- __PTV-Vissim co-simulation.__  
  + How to.  
  + Limitations.  

- __SUMO co-simulation.__  
  + New towns. 04 and 05??  
  + Traffic lights integrated???  
  + spawn_npc.py script for SUMO??  

- __OpenDRIVE standalone mode.__  
  + Added crosswalks for pedestrians.  
  + Security checks to prevent cars from falling into the abyss.  

- __RSS sensor.__  
  + Integration with the whole road network.  
  + RssCheck object conversion done in parallel using tbb.  
  + Generated Python interfaces of add:physics, ad::map and ad:rss types.  

- __Traffic manager.__  
  + Hybrid mode to run the module without physics when further than a distance from the ego vehicle.  
  + Performance improvement on collision calculations and waypoint binning.  
  + New iteration on the Traffic Manager inner architecture.  

- __Landmark management.__  
  + Automatic generation in the map of traffic lights, and stop and yield signals objects from the OpenDRIVE file.  

- __API extensions.__  
  + The method `carla.Vehicle.set_autopilot()` now has a `carla.TrafficManager` as parameter.  
  + Classes `carla.Landmark`, `carla.LandmarkType`, and `carla.LandmarkOrientation`.  
  + Added new methods to `carla.Map`: `get_all_landmarks()`, `get_all_landmarks_from_id()`, `get_all_landmarks_of_type()`, and `get_landmark_group()`.  
  + Added new methods to `carla.Waypoint`: `get_landmarks()`, and `get_landmarks_of_type()`.  
  + Added new methods to `carla.World`: `get_traffic_light()`, and `get_traffic_sign()`.  
  + RSS classes and enums. `carla.RssSensor`, `carla.RssRestrictor`, `carla.RssResponse`, `carla.RssEGoDynamycsOnRoute`, `carla.RssRoudBoundariesMode`, `carla.RssVisualizationMode`.  

- __Documentation.__  
  + Retrieve data tutorial.  
  + Map ingestion: importing assets, creating maps...
  + RSS specific page, sensor definition and API doc. 
  + RSS classes and enums.  
  + API separates Dunder methods.  
  + Methods ordered alphabetically with *getters* and *setters* at the end.  

- __Town10HD.__  
  + A new map available in CARLA, based on realism. 
  + New buildings, including a museum, parking, apartments, factory, hotel and different skyscrapers. 
  + New props such as fountains, 
  + New PBR materials for streets, roads, and assets.
  + BP_Power_poles. A blueprint to spawn power poles. 
  + BP_Lights. A blueprint for assets using lights that exposes these in the API. 
  + BP_Procedural_Buildings. A tool to create procedural buildings. 

- __Fixes.__  
  + Updated material for the glass of vehicle lights.  
  + Fixed autonomous agents' incorrect detection of red traffic lights affecting them.  
  + Improved `manual_control.py` for a more realistic throttle and brake.  
  + Dead links in the documentation. 
