---
layout: post
comments: true
title:  "CARLA 0.9.13 Release"
subtitle: "User defined traffic manager paths, carla-agents Python package, user defined pedestrian animations and new vehicle behaviours"
description: "User defined traffic manager paths, carla-agents Python package, user defined pedestrian animations and new vehicle behaviours"
author: "@corkyw10"
image: 'img/carla.jpg'
background: '/img/posts/2021-08-02/town10.png'
---

{% include youtube.html id="tWAg1fIDNCg" %}

{% include release_button.html release_tag="0.9.13" %}

The __0.9.13 release of CARLA__ is finally here, so read on to see how the new improvements are going to boost your work. 

CARLA 0.9.13 brings a host of new API features and improvements for pedestrian and vehicle behaviour and the traffic manager to better mimic real world behaviour of cars and people.

The CARLA garage now has a __new vehicle__, the __Volkswagen T2 2021__. All generation 1 and 2 cars now include opening doors that can interact with the environment through collisions, especially useful for training and testing autonomous vehicles in car parks or on tight city streets. 

The traffic manager now offers __new API functionality__ to guide vehicles with a __user defined path__, defined by location waypoints or through route commands like left, right, straight, etc.

__Installation improvements:__ the CARLA agents wheel is now __available through PyPi__ so can now be installed with pip. A new wheel for the CARLA library is now also available for Python version 3.9.

The user can also now define custom animations and gestures for pedestrians through the python API. 
 

- [__Traffic Manager__](#traffic-manager): New functions for user defined paths
- [__New and improved vehicles__](#new-and-improved-vehicles): A brand new vehicle and opening doors with improved breaking and gear behaviour
- [__Python library upgrades__](#python-library-upgrades): carla-agents library now available through PyPi and new Python 3.9 wheels
- [__Runtime texture updating__](#runtime-texture-updates): Runtime texture updating through the CARLA Python API


## Traffic Manager

The traffic manager has been extended with some great new functionality to extend user control over the behaviour of vehicles in the traffic manager. The API now exposes new traffic manager functions that can be used to guide vehicles with a user-defined custom path.

The set_path function allows a custom route to be defined using coordinates defined as CARLA Locations:

```py
path = [carla.Location(x=-506.696198, y=179.384308, z=0.038194),
                    carla.Location(x=-504.745972, y=232.868927, z=0.039417)]
traffic_manager.set_path(vehicle, path)
```
The set_route function allows a custom route to be defined using route commands:

```py
route = ["Right", "Straight", "Right", "Right", "Left", "Right"]
 traffic_manager.set_route(vehicle, route)
```

## New and Improved Vehicles

### Opening Doors

All generation 1 and generation 2 vehicles now have articulated doors that can be opened and closed through functions in the python API. This functionality is ideal for simulating scenarios in busy city streets and car parks where doors may open unpredictably while driving past or might be blocking access to parking spaces or passageways. 

![doors](/img/posts/2021-11-07/doors.gif){:class="img-fluid rounded mx-auto d-block"}

### Improved vehicle behaviour - gears and breaking

Vehicle physics has been improved with updated breaking distances, acceleration and gear behaviour. Breaking and accelerating behaviour of the vehicles has been carefully remodelled to more accurately capture the behaviour of the CARLA garage vehiclesâ€™ real world counterparts, with much care taken to reproduce published breaking distance behaviour as accurately as possible. Similarly the gear change behaviour has been altered to better model real world behaviour gear changes.

![accelleration](/img/posts/2021-11-07/acceleration.gif){:class="img-fluid rounded mx-auto d-block"}

### New Volkswagen van

The CARLA garage has built an exciting new vehicle, the Volkswagen T2 2021. Add some colour to your city traffic with beautiful retro-styled vehicles. 

![vwvan](/img/posts/2021-11-07/vwvan.gif){:class="img-fluid rounded mx-auto d-block"}

## Python library upgrades

Continuing to improve the useability of the CARLA Python API, the CARLA agents package that allows custom control of NPC vehicles within the simulation is now distributed through PyPi.  Up until now the CARLA agents package has been delivered as an egg file in the CARLA core package requiring . carla-agents now available as a python wheel through PyPi, allowing a convenient installation through the native python package manager PIP.

```sh
pip install carla-agents
```

New wheels are now available for Python version 3.9 for both Linux and Windows. 

## Custom pedestrian animations using the Python API

Pedestrian animations can now be customised through the Python API, allowing user-defined gestures and behaviours for pedestrian actors within the simulation. The API exposes functions to define paths for bones controlling the pedestrian bodies to allow the posibility to add gestures beyond standard walking behaviour such as waving, crouching, jumping or falling. This exciting new functionality allows the development of specific edge case scenarios containing unusual pedestrian behaviour.

## Runtime texture updating

The API now exposes functionality to update textures during runtime to allow texture modification without relying on the UE4 editor. This can be useful for example when training neural networks to reduce the potential for overfitting, allowing more emphasis on features of road layout or buildings rather than surface textures.

```py
texture = carla.TextureColor(width,height)
for x in range(0,len(image[0])):
    for y in range(0,len(image)):
        color = image[y][x]
        r = int(color[0])
        g = int(color[1])
        b = int(color[2])
        a = int(color[3])
        texture.set(x, height - y - 1, carla.Color(r,g,b,a))
world.apply_color_texture_to_object('SM_Cartel_Add_5', carla.MaterialParameter.Diffuse, texture, 0)
```